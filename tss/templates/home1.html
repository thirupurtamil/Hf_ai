<!DOCTYPE html>
<html>
<head>
    <title>NSE Live Data</title>
</head>
<body>
    <h2>NSE Option Chain Live Updates</h2>
    <table border="1" id="nse-table">
        <thead>
            <tr>
                <th>Strike</th>
                <th>Option</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>LTP</th>
                <th>Volume</th>
                <th>Value</th>
                <th>OI</th>
                <th>Change OI</th>
                <th>Nifty</th>
                <th>Expiry</th>
                <th>IV</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const socket = new WebSocket('ws://127.0.0.1:8000/ws/live-data/');
        const tableBody = document.querySelector("#nse-table tbody");

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            tableBody.innerHTML = "";

            data.slice(0, 20).forEach(row => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${row.Strike}</td>
                    <td>${row.Option}</td>
                    <td>${row.open}</td>
                    <td>${row.high}</td>
                    <td>${row.low}</td>
                    <td>${row.ltp}</td>
                    <td>${row.volume}</td>
                    <td>${row.value}</td>
                    <td>${row.open_in}</td>
                    <td>${row.change}</td>
                    <td>${row.n50}</td>
                    <td>${row.expriydate}</td>
                    <td>${row.iv}</td>
                `;
                tableBody.appendChild(tr);
            });
        };
    </script>
</body>
</html>