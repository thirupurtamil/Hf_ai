


{% extends "home/base.html" %}
<!DOCTYPE html>
<html>
<head>
    <title>Active Contracts</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .price-up { color: green; }
        .price-down { color: red; }
    </style>
</head>
<body>
    <h1>Active Contracts</h1>
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Strike</th>
                <th>Option</th>
                <th>LTP</th>
                <th>OI</th>
            </tr>
        </thead>
        <tbody id="contracts-body"></tbody>
    </table>

    <script>
        function updateRowFast(row, data, columns){
            columns.forEach(col => {
                const cell = row.querySelector(`[data-col="${col}"]`);
                if(cell && cell.innerText != data[col]){
                    cell.className = (parseFloat(data[col]) > parseFloat(cell.innerText || 0)) ? "price-up" : "price-down";
                    cell.innerText = data[col];
                }
            });
        }

        function renderTableFast(bodyId, data, columns){
            const tbody = document.getElementById(bodyId);
            data.forEach((rowData, i) => {
                let tr = tbody.rows[i];
                if(!tr){
                    tr = tbody.insertRow();
                    columns.forEach(col => {
                        const td = tr.insertCell();
                        td.setAttribute("data-col", col);
                    });
                }
                updateRowFast(tr, rowData, columns);
            });
        }

        const ws = new WebSocket("ws://localhost:8000/ws/contracts/");
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            renderTableFast("contracts-body", data.contracts, ["Strike","Option","ltp","oi"]);
        };
    </script>
</body>
</html>